<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®°å¿†å¡ç‰‡åº”ç”¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
            background: linear-gradient(135deg, #e0f2fe 0%, #ddd6fe 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 24px;
            margin-bottom: 24px;
        }

        .paste-area {
            margin-top: 16px;
        }

        .paste-textarea {
            width: 100%;
            min-height: 150px;
            padding: 12px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.875rem;
            resize: vertical;
        }

        .paste-textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .btn-secondary {
            background: #10b981;
            color: white;
        }

        .btn-secondary:hover {
            background: #059669;
        }

        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            }

            .card {
                background: #1f2937;
                color: #e5e7eb;
            }

            h1, .study-title {
                color: #f9fafb;
            }

            .subtitle {
                color: #9ca3af;
            }

            .flashcard-item {
                background: #1f2937;
            }

            .flashcard-info h3 {
                color: #f9fafb;
            }

            .flashcard-info p {
                color: #9ca3af;
            }

            .empty-state {
                background: #1f2937;
                color: #9ca3af;
            }

            .info-box {
                background: #374151;
                color: #d1d5db;
            }

            .info-box pre {
                background: #1f2937;
                color: #e5e7eb;
            }

            .edit-input, .paste-textarea {
                background: #374151;
                border-color: #4b5563;
                color: #e5e7eb;
            }

            .edit-input:focus, .paste-textarea:focus {
                border-color: #6366f1;
            }

            .paste-textarea {
                border-style: dashed;
            }

            .btn-prev {
                background: #374151;
                color: #e5e7eb;
            }

            .btn-prev:hover:not(:disabled) {
                background: #4b5563;
            }

            .back-btn {
                color: #818cf8;
            }

            .back-btn:hover {
                color: #a5b4fc;
            }

            .btn-icon {
                color: #9ca3af;
            }

            .btn-icon:hover {
                color: #818cf8;
                background: #374151;
            }

            .card-counter, .flip-hint {
                color: #9ca3af;
            }
        }

        h1 {
            font-size: 2rem;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .subtitle {
            color: #6b7280;
            margin-bottom: 16px;
        }

        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .status-message.show {
            display: flex;
        }

        .status-message.success {
            background: #d1fae5;
            color: #065f46;
        }

        .status-message.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-message.info {
            background: #dbeafe;
            color: #1e40af;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .file-input-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .info-box {
            background: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            font-size: 0.875rem;
            color: #4b5563;
        }

        .info-box strong {
            display: block;
            margin-bottom: 4px;
        }

        .info-box pre {
            background: white;
            padding: 8px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 0.75rem;
            overflow-x: auto;
        }

        .flashcard-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .flashcard-item {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 24px;
            transition: box-shadow 0.2s;
        }

        .flashcard-item:hover {
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
        }

        .flashcard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flashcard-info h3 {
            font-size: 1.25rem;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .flashcard-info p {
            color: #6b7280;
            font-size: 0.875rem;
        }

        .flashcard-actions {
            display: flex;
            gap: 8px;
        }

        .btn-study {
            background: #4f46e5;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .btn-study:hover {
            background: #4338ca;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            color: #6b7280;
            border-radius: 4px;
        }

        .btn-icon:hover {
            color: #4f46e5;
            background: #f3f4f6;
        }

        .btn-icon.delete:hover {
            color: #dc2626;
        }

        .empty-state {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 48px;
            text-align: center;
            color: #6b7280;
        }

        /* Study Mode Styles */
        .study-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .study-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .back-btn {
            color: #4f46e5;
            font-weight: 500;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 1rem;
        }

        .back-btn:hover {
            color: #4338ca;
        }

        .study-title {
            font-size: 1.25rem;
            color: #1f2937;
        }

        .card-counter {
            text-align: center;
            color: #6b7280;
            font-size: 0.875rem;
            margin-bottom: 16px;
        }

        .flashcard {
            background: #000000;
            border-radius: 16px;
            padding: 48px;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .flashcard.flipped {
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
        }

        .flashcard:hover {
            transform: scale(1.02);
        }

        .flashcard-content {
            color: white;
            font-size: 1.25rem;
            text-align: center;
            line-height: 1.8;
        }

        .flip-hint {
            text-align: center;
            color: #6b7280;
            font-size: 0.875rem;
            margin-top: 16px;
            margin-bottom: 24px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
        }

        .btn-nav {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-prev {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-prev:hover:not(:disabled) {
            background: #d1d5db;
        }

        .btn-next {
            background: #4f46e5;
            color: white;
        }

        .btn-next:hover:not(:disabled) {
            background: #4338ca;
        }

        .btn-nav:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .edit-form {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .edit-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
        }

        .edit-input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="homeView">
            <div class="card">
                <h1>è®°å¿†å¡ç‰‡åº”ç”¨</h1>
                <p class="subtitle">å¯¼å…¥CSVæ–‡ä»¶åˆ›å»ºå¡ç‰‡ç»„</p>
                
                <div id="statusMessage" class="status-message"></div>
                
                <label class="btn btn-primary file-input-label">
                    <span>ğŸ“</span>
                    <span id="uploadBtnText">å¯¼å…¥CSVæ–‡ä»¶</span>
                    <input type="file" id="fileInput" accept=".csv" style="display: none;">
                </label>
                
                <div class="paste-area">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">æˆ–ç›´æ¥ç²˜è´´CSVå†…å®¹ï¼š</label>
                    <textarea id="pasteArea" class="paste-textarea" placeholder="åœ¨æ­¤ç²˜è´´CSVå†…å®¹...
ç¤ºä¾‹ï¼š
&quot;é—®é¢˜1&quot;,&quot;ç­”æ¡ˆ1&quot;
&quot;é—®é¢˜2&quot;,&quot;ç­”æ¡ˆ2&quot;"></textarea>
                    <div style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap;">
                        <button class="btn btn-secondary" onclick="processPastedContent()">
                            ğŸ“‹ ä»ç²˜è´´å†…å®¹åˆ›å»ºå¡ç‰‡
                        </button>
                        <button class="btn btn-secondary" onclick="copyPromptToClipboard()" style="background: #8b5cf6;">
                            ğŸ¤– å¤åˆ¶AIæç¤ºè¯
                        </button>
                    </div>
                </div>
                
                <div class="info-box">
                    <strong>CSVæ ¼å¼ï¼š</strong> CSVæ–‡ä»¶åº”åŒ…å«ä¸¤åˆ—ï¼šé—®é¢˜,ç­”æ¡ˆ
                    <br>
                    <strong>ç¤ºä¾‹ï¼š</strong>
                    <pre>"2+2ç­‰äºå¤šå°‘ï¼Ÿ","4"
"æ³•å›½çš„é¦–éƒ½æ˜¯ï¼Ÿ","å·´é»"</pre>
                </div>
            </div>

            <div id="flashcardList" class="flashcard-list"></div>
        </div>

        <div id="studyView" class="hidden">
            <div class="card study-container">
                <div class="study-header">
                    <button class="back-btn" onclick="exitStudyMode()">â† è¿”å›å¡ç‰‡ç»„</button>
                    <h2 class="study-title" id="studyTitle"></h2>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-icon" onclick="shuffleCards()" title="éšæœºæ’åº">ğŸ”€</button>
                        <button class="btn-icon" onclick="resetStudy()" title="é‡æ–°å¼€å§‹">ğŸ”„</button>
                    </div>
                </div>
                
                <div class="card-counter" id="cardCounter"></div>
                
                <div class="flashcard" id="flashcardElement" onclick="flipCard()">
                    <div class="flashcard-content" id="cardContent"></div>
                </div>
                
                <div class="flip-hint" id="flipHint"></div>
                
                <div class="navigation">
                    <button class="btn-nav btn-prev" id="prevBtn" onclick="previousCard()">
                        â† ä¸Šä¸€å¼ 
                    </button>
                    <button class="btn-nav btn-next" id="nextBtn" onclick="nextCard()">
                        ä¸‹ä¸€å¼  â†’
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let flashcardSets = [];
        let currentSetId = null;
        let currentCardIndex = 0;
        let isFlipped = false;
        let shuffledCards = null;

        window.addEventListener('DOMContentLoaded', loadFlashcardSets);

        function loadFlashcardSets() {
            try {
                const savedSets = localStorage.getItem('flashcardSets');
                if (savedSets) {
                    flashcardSets = JSON.parse(savedSets);
                    flashcardSets.sort((a, b) => b.createdAt - a.createdAt);
                }
                renderFlashcardList();
            } catch (error) {
                console.error('åŠ è½½å¡ç‰‡ç»„æ—¶å‡ºé”™ï¼š', error);
                flashcardSets = [];
                renderFlashcardList();
            }
        }

        function saveFlashcardSets() {
            try {
                localStorage.setItem('flashcardSets', JSON.stringify(flashcardSets));
                return true;
            } catch (error) {
                console.error('ä¿å­˜å¡ç‰‡ç»„æ—¶å‡ºé”™ï¼š', error);
                return false;
            }
        }

        function renderFlashcardList() {
            const listContainer = document.getElementById('flashcardList');
            
            if (flashcardSets.length === 0) {
                listContainer.innerHTML = '<div class="empty-state">è¿˜æ²¡æœ‰å¡ç‰‡ç»„ã€‚å¯¼å…¥CSVæ–‡ä»¶å¼€å§‹ä½¿ç”¨å§ï¼</div>';
                return;
            }

            listContainer.innerHTML = flashcardSets.map(set => `
                <div class="flashcard-item" id="set-${set.id}">
                    <div class="flashcard-header">
                        <div class="flashcard-info">
                            <div id="name-${set.id}">
                                <h3>${set.name}</h3>
                                <p>${set.cards.length} å¼ å¡ç‰‡</p>
                                <p style="font-size: 0.75rem; color: #9ca3af;">åˆ›å»ºäºï¼š${new Date(set.createdAt).toLocaleDateString('zh-CN')}</p>
                            </div>
                            <div id="edit-${set.id}" class="edit-form hidden">
                                <input type="text" class="edit-input" id="editInput-${set.id}" value="${set.name}">
                                <button class="btn btn-primary" onclick="saveEdit('${set.id}')">ä¿å­˜</button>
                                <button class="btn" onclick="cancelEdit('${set.id}')" style="background: #e5e7eb; color: #374151;">å–æ¶ˆ</button>
                            </div>
                        </div>
                        <div class="flashcard-actions" id="actions-${set.id}">
                            <button class="btn-study" onclick="startStudying('${set.id}')">
                                â–¶ å¼€å§‹å­¦ä¹ 
                            </button>
                            <button class="btn-icon" onclick="startEditing('${set.id}')" title="é‡å‘½å">âœï¸</button>
                            <button class="btn-icon delete" onclick="deleteSet('${set.id}')" title="åˆ é™¤">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('fileInput').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (!file) return;

            showStatus('æ­£åœ¨è¯»å–æ–‡ä»¶...', 'info');
            const uploadBtn = document.getElementById('uploadBtnText');
            uploadBtn.textContent = 'å¤„ç†ä¸­...';

            const reader = new FileReader();
            
            reader.onerror = () => {
                showStatus('è¯»å–æ–‡ä»¶å‡ºé”™ï¼Œè¯·é‡è¯•ã€‚', 'error');
                uploadBtn.textContent = 'å¯¼å…¥CSVæ–‡ä»¶';
            };
            
            reader.onload = (e) => {
                try {
                    const text = e.target.result;
                    const lines = text.split(/\r?\n/).filter(line => line.trim());
                    
                    const cards = [];
                    
                    for (let line of lines) {
                        line = line.trim();
                        if (!line) continue;
                        
                        const regex = /"([^"]*)"|([^,]+)/g;
                        const parts = [];
                        let match;
                        
                        while ((match = regex.exec(line)) !== null) {
                            parts.push(match[1] !== undefined ? match[1] : match[2]);
                        }
                        
                        if (parts.length >= 2) {
                            const front = parts[0].trim();
                            const back = parts[1].trim();
                            
                            if (front && back) {
                                cards.push({ front, back });
                            }
                        }
                    }

                    console.log('è§£æçš„å¡ç‰‡æ•°ï¼š', cards.length);
                    
                    if (cards.length > 0) {
                        showStatus(`å·²è§£æ ${cards.length} å¼ å¡ç‰‡ã€‚è¯·è¾“å…¥åç§°...`, 'info');
                        
                        setTimeout(() => {
                            const defaultName = file.name.replace('.csv', '').replace(/[^a-zA-Z0-9\u4e00-\u9fa5 -]/g, '');
                            const setName = prompt(`æ‰¾åˆ° ${cards.length} å¼ è®°å¿†å¡ç‰‡ï¼\n\nè¯·ä¸ºæ­¤å¡ç‰‡ç»„å‘½åï¼š`, defaultName);
                            
                            if (setName && setName.trim()) {
                                showStatus('æ­£åœ¨ä¿å­˜å¡ç‰‡ç»„...', 'info');
                                
                                const newSet = {
                                    id: Date.now().toString(),
                                    name: setName.trim(),
                                    cards: cards,
                                    createdAt: Date.now()
                                };

                                flashcardSets.push(newSet);
                                
                                if (saveFlashcardSets()) {
                                    loadFlashcardSets();
                                    showStatus(`âœ“ æˆåŠŸå¯¼å…¥ ${cards.length} å¼ å¡ç‰‡ä¸º"${setName}"ï¼`, 'success');
                                } else {
                                    showStatus('ä¿å­˜å¡ç‰‡ç»„å¤±è´¥ã€‚å­˜å‚¨ç©ºé—´å¯èƒ½å·²æ»¡ã€‚', 'error');
                                    flashcardSets.pop();
                                }
                            } else {
                                showStatus('å·²å–æ¶ˆå¯¼å…¥', 'error');
                            }
                            
                            uploadBtn.textContent = 'å¯¼å…¥CSVæ–‡ä»¶';
                        }, 100);
                    } else {
                        showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å¡ç‰‡ã€‚è¯·æ£€æŸ¥CSVæ ¼å¼ã€‚', 'error');
                        uploadBtn.textContent = 'å¯¼å…¥CSVæ–‡ä»¶';
                    }
                } catch (error) {
                    console.error('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™ï¼š', error);
                    showStatus(`é”™è¯¯ï¼š${error.message}`, 'error');
                    uploadBtn.textContent = 'å¯¼å…¥CSVæ–‡ä»¶';
                }
            };
            
            reader.readAsText(file, 'UTF-8');
            event.target.value = '';
        });

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message ${type} show`;
            
            setTimeout(() => {
                statusEl.classList.remove('show');
            }, 5000);
        }

        function deleteSet(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤å¡ç‰‡ç»„å—ï¼Ÿ')) {
                flashcardSets = flashcardSets.filter(s => s.id !== id);
                if (saveFlashcardSets()) {
                    loadFlashcardSets();
                    showStatus('å¡ç‰‡ç»„å·²åˆ é™¤', 'success');
                } else {
                    showStatus('åˆ é™¤å¡ç‰‡ç»„å¤±è´¥', 'error');
                }
            }
        }

        function startEditing(id) {
            document.getElementById(`name-${id}`).classList.add('hidden');
            document.getElementById(`edit-${id}`).classList.remove('hidden');
            document.getElementById(`actions-${id}`).classList.add('hidden');
            document.getElementById(`editInput-${id}`).focus();
        }

        function cancelEdit(id) {
            document.getElementById(`name-${id}`).classList.remove('hidden');
            document.getElementById(`edit-${id}`).classList.add('hidden');
            document.getElementById(`actions-${id}`).classList.remove('hidden');
        }

        function saveEdit(id) {
            const newName = document.getElementById(`editInput-${id}`).value.trim();
            if (!newName) return;

            const set = flashcardSets.find(s => s.id === id);
            if (set) {
                set.name = newName;
                if (saveFlashcardSets()) {
                    loadFlashcardSets();
                    showStatus('åç§°å·²æ›´æ–°', 'success');
                } else {
                    showStatus('æ›´æ–°åç§°å¤±è´¥', 'error');
                }
            }
        }

        function startStudying(setId) {
            currentSetId = setId;
            currentCardIndex = 0;
            isFlipped = false;
            shuffledCards = null;
            
            const set = flashcardSets.find(s => s.id === setId);
            document.getElementById('studyTitle').textContent = set.name;
            
            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('studyView').classList.remove('hidden');
            
            updateStudyCard();
        }

        function exitStudyMode() {
            document.getElementById('studyView').classList.add('hidden');
            document.getElementById('homeView').classList.remove('hidden');
        }

        function updateStudyCard() {
            const set = flashcardSets.find(s => s.id === currentSetId);
            const cards = shuffledCards || set.cards;
            const card = cards[currentCardIndex];
            
            document.getElementById('cardCounter').textContent = `ç¬¬ ${currentCardIndex + 1} å¼ ï¼Œå…± ${cards.length} å¼ `;
            document.getElementById('cardContent').textContent = isFlipped ? card.back : card.front;
            document.getElementById('flipHint').textContent = isFlipped ? 'ç­”æ¡ˆ - ç‚¹å‡»å¡ç‰‡ç¿»è½¬' : 'é—®é¢˜ - ç‚¹å‡»å¡ç‰‡ç¿»è½¬';
            
            document.getElementById('prevBtn').disabled = currentCardIndex === 0;
            document.getElementById('nextBtn').disabled = currentCardIndex === cards.length - 1;
        }

        function flipCard() {
            isFlipped = !isFlipped;
            updateStudyCard();
        }

        function nextCard() {
            const set = flashcardSets.find(s => s.id === currentSetId);
            const cards = shuffledCards || set.cards;
            if (currentCardIndex < cards.length - 1) {
                currentCardIndex++;
                isFlipped = false;
                updateStudyCard();
            }
        }

        function previousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                isFlipped = false;
                updateStudyCard();
            }
        }

        function resetStudy() {
            currentCardIndex = 0;
            isFlipped = false;
            shuffledCards = null;
            updateStudyCard();
        }

        function shuffleCards() {
            const set = flashcardSets.find(s => s.id === currentSetId);
            shuffledCards = [...set.cards];
            
            for (let i = shuffledCards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledCards[i], shuffledCards[j]] = [shuffledCards[j], shuffledCards[i]];
            }
            
            currentCardIndex = 0;
            isFlipped = false;
            updateStudyCard();
        }

        function copyPromptToClipboard() {
            const promptText = 'å‡†å¤‡å…³äº........çš„è®°å¿†å¡ç‰‡ï¼Œä»¥CSVæ ¼å¼æ˜¾ç¤ºã€‚ç¬¬ä¸€åˆ—æ˜¯é—®é¢˜ï¼Œç¬¬äºŒåˆ—æ˜¯ç­”æ¡ˆã€‚';
            
            navigator.clipboard.writeText(promptText).then(() => {
                showStatus('âœ“ AIæç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼åœ¨å¤§è¯­è¨€æ¨¡å‹ä¸­ä½¿ç”¨å®ƒæ¥ç”Ÿæˆè®°å¿†å¡ç‰‡ã€‚', 'success');
            }).catch(err => {
                const textarea = document.createElement('textarea');
                textarea.value = promptText;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    showStatus('âœ“ AIæç¤ºè¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼åœ¨å¤§è¯­è¨€æ¨¡å‹ä¸­ä½¿ç”¨å®ƒæ¥ç”Ÿæˆè®°å¿†å¡ç‰‡ã€‚', 'success');
                } catch (err) {
                    showStatus('å¤åˆ¶å¤±è´¥ã€‚è¯·æ‰‹åŠ¨å¤åˆ¶ï¼š' + promptText, 'error');
                }
                document.body.removeChild(textarea);
            });
        }

        function processPastedContent() {
            const textarea = document.getElementById('pasteArea');
            const text = textarea.value.trim();
            
            if (!text) {
                alert('è¯·å…ˆç²˜è´´CSVå†…å®¹ï¼');
                return;
            }

            showStatus('æ­£åœ¨å¤„ç†ç²˜è´´çš„å†…å®¹...', 'info');

            try {
                const lines = text.split(/\r?\n/).filter(line => line.trim());
                const cards = [];
                
                for (let line of lines) {
                    line = line.trim();
                    if (!line) continue;
                    
                    const regex = /"([^"]*)"|([^,]+)/g;
                    const parts = [];
                    let match;
                    
                    while ((match = regex.exec(line)) !== null) {
                        parts.push(match[1] !== undefined ? match[1] : match[2]);
                    }
                    
                    if (parts.length >= 2) {
                        const front = parts[0].trim();
                        const back = parts[1].trim();
                        
                        if (front && back) {
                            cards.push({ front, back });
                        }
                    }
                }

                console.log('ä»ç²˜è´´å†…å®¹è§£æçš„å¡ç‰‡æ•°ï¼š', cards.length);
                
                if (cards.length > 0) {
                    showStatus(`å·²è§£æ ${cards.length} å¼ å¡ç‰‡ã€‚è¯·è¾“å…¥åç§°...`, 'info');
                    
                    setTimeout(() => {
                        const setName = prompt(`æ‰¾åˆ° ${cards.length} å¼ è®°å¿†å¡ç‰‡ï¼\n\nè¯·ä¸ºæ­¤å¡ç‰‡ç»„å‘½åï¼š`, 'æˆ‘çš„è®°å¿†å¡ç‰‡');
                        
                        if (setName && setName.trim()) {
                            showStatus('æ­£åœ¨ä¿å­˜å¡ç‰‡ç»„...', 'info');
                            
                            const newSet = {
                                id: Date.now().toString(),
                                name: setName.trim(),
                                cards: cards,
                                createdAt: Date.now()
                            };

                            flashcardSets.push(newSet);
                            
                            if (saveFlashcardSets()) {
                                loadFlashcardSets();
                                showStatus(`âœ“ æˆåŠŸåˆ›å»º ${cards.length} å¼ å¡ç‰‡ä¸º"${setName}"ï¼`, 'success');
                                textarea.value = '';
                            } else {
                                showStatus('ä¿å­˜å¡ç‰‡ç»„å¤±è´¥ã€‚å­˜å‚¨ç©ºé—´å¯èƒ½å·²æ»¡ã€‚', 'error');
                                flashcardSets.pop();
                            }
                        } else {
                            showStatus('å·²å–æ¶ˆå¯¼å…¥', 'error');
                        }
                    }, 100);
                } else {
                    showStatus('æœªæ‰¾åˆ°æœ‰æ•ˆçš„å¡ç‰‡ã€‚è¯·æ£€æŸ¥CSVæ ¼å¼ã€‚', 'error');
                }
            } catch (error) {
                console.error('å¤„ç†ç²˜è´´å†…å®¹æ—¶å‡ºé”™ï¼š', error);
                showStatus(`é”™è¯¯ï¼š${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
